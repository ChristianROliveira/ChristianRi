<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle de Gastos</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f9f9f9;
      --card: #fff;
      --primary: #28a745;
      --danger: #dc3545;
      --text: #333;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg);
      color: var(--text);
    }
    h1, h2 {
      color: var(--text);
    }
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .tabs button {
      padding: 10px 16px;
      border: none;
      background: #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .tabs button.active {
      background: var(--primary);
      color: white;
    }
    .tab-content {
      display: none;
      background: var(--card);
      padding: 20px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .tab-content.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .summary p {
      margin: 8px 0;
    }
    canvas {
      width: 100% !important;
      max-width: 100%;
      height: auto !important;
    }
    @media (max-width: 600px) {
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <h1>ðŸ’¸ Controle de Gastos</h1>
  <div class="tabs">
    <button class="tab-btn active" data-tab="resumo">ðŸ“Š Resumo</button>
    <button class="tab-btn" data-tab="transacao">âž• Nova TransaÃ§Ã£o</button>
    <button class="tab-btn" data-tab="metas">ðŸŽ¯ Metas</button>
  </div>

  <div id="resumo" class="tab-content active">
    <h2>Resumo Mensal</h2>
    <canvas id="grafico"></canvas>
    <div id="resumoDados" class="summary"></div>
  </div>

  <div id="transacao" class="tab-content">
    <h2>Adicionar TransaÃ§Ã£o</h2>
    <form id="formTransacao">
      <label>DescriÃ§Ã£o<input type="text" id="descricao" required></label>
      <label>Valor (R$)<input type="number" id="valor" required></label>
      <label>Categoria<input type="text" id="categoria" required></label>
      <label>MÃªs<select id="mes"></select></label>
      <label>Tipo<select id="tipo">
        <option value="entrada">Entrada</option>
        <option value="saida">SaÃ­da</option>
      </select></label>
      <label>NÃºmero de Parcelas<input type="number" id="parcelas" value="1" min="1"></label>
      <button type="submit" class="btn">Salvar</button>
    </form>
  </div>

  <div id="metas" class="tab-content">
    <h2>Definir Meta</h2>
    <form id="formMeta">
      <label>Categoria<input type="text" id="metaCategoria" required></label>
      <label>Valor (R$)<input type="number" id="metaValor" required></label>
      <label>MÃªs<select id="metaMes"></select></label>
      <button type="submit" class="btn">Salvar Meta</button>
    </form>
    <div id="listaMetas" class="summary"></div>
  </div>

  <script>
    const meses = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
    let transacoes = {};
    let metas = {};
    let parcelasPendentes = [];

    const chartCtx = document.getElementById('grafico').getContext('2d');
    let chart;

    function initSelects() {
      const mesSelects = [document.getElementById('mes'), document.getElementById('metaMes')];
      mesSelects.forEach(select => {
        select.innerHTML = '';
        meses.forEach(m => {
          const opt = new Option(m, m);
          select.appendChild(opt);
        });
      });
    }

    function carregarDados() {
      transacoes = JSON.parse(localStorage.getItem('transacoes')) || {};
      metas = JSON.parse(localStorage.getItem('metas')) || {};
      parcelasPendentes = JSON.parse(localStorage.getItem('parcelasPendentes')) || [];
      meses.forEach(m => transacoes[m] = transacoes[m] || { entradas: 0, saidas: 0 });
    }

    function salvarDados() {
      localStorage.setItem('transacoes', JSON.stringify(transacoes));
      localStorage.setItem('metas', JSON.stringify(metas));
      localStorage.setItem('parcelasPendentes', JSON.stringify(parcelasPendentes));
    }

    function atualizarParcelas() {
      const hoje = new Date();
      if (hoje.getDate() !== 1) return;
      parcelasPendentes.forEach(p => {
        if (p.restantes > 0) {
          transacoes[p.mesAtual][p.tipo === 'entrada' ? 'entradas' : 'saidas'] += p.valorMensal;
          p.restantes--;
          p.mesAtual = proximoMes(p.mesAtual);
        }
      });
      salvarDados();
    }

    function proximoMes(mes) {
      const i = meses.indexOf(mes);
      return meses[(i + 1) % 12];
    }

    function atualizarResumo() {
      const resumo = document.getElementById('resumoDados');
      resumo.innerHTML = '';
      const entradas = [], saidas = [];
      meses.forEach(mes => {
        const { entradas: e, saidas: s } = transacoes[mes];
        const saldo = e - s;
        entradas.push(e);
        saidas.push(s);
        resumo.innerHTML += `<p><strong>${mes}:</strong> Entradas: R$ ${e.toFixed(2)}, SaÃ­das: R$ ${s.toFixed(2)}, Saldo: R$ ${saldo.toFixed(2)}</p>`;
      });
      if (chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type: 'bar',
        data: {
          labels: meses,
          datasets: [
            { label: 'Entradas', data: entradas, backgroundColor: '#28a745' },
            { label: 'SaÃ­das', data: saidas, backgroundColor: '#dc3545' },
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function atualizarMetas() {
      const lista = document.getElementById('listaMetas');
      lista.innerHTML = '';
      for (const mes in metas) {
        lista.innerHTML += `<strong>${mes}</strong><br>`;
        for (const cat in metas[mes]) {
          lista.innerHTML += `${cat}: R$ ${metas[mes][cat]}<br>`;
        }
      }
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
        if (btn.dataset.tab === 'resumo') atualizarResumo();
      };
    });

    document.getElementById('formTransacao').onsubmit = e => {
      e.preventDefault();
      const mes = document.getElementById('mes').value;
      const tipo = document.getElementById('tipo').value;
      const valor = parseFloat(document.getElementById('valor').value);
      const parcelas = parseInt(document.getElementById('parcelas').value);
      const valorParcela = +(valor / parcelas).toFixed(2);

      if (parcelas === 1) {
        transacoes[mes][tipo === 'entrada' ? 'entradas' : 'saidas'] += valor;
      } else {
        parcelasPendentes.push({
          descricao: document.getElementById('descricao').value,
          valorMensal: valorParcela,
          tipo,
          mesAtual: mes,
          restantes: parcelas
        });
      }

      salvarDados();
      e.target.reset();
      atualizarResumo();
    };

    document.getElementById('formMeta').onsubmit = e => {
      e.preventDefault();
      const mes = document.getElementById('metaMes').value;
      const categoria = document.getElementById('metaCategoria').value;
      const valor = parseFloat(document.getElementById('metaValor').value);
      metas[mes] = metas[mes] || {};
      metas[mes][categoria] = valor;
      salvarDados();
      e.target.reset();
      atualizarMetas();
    };

    initSelects();
    carregarDados();
    atualizarParcelas();
    atualizarResumo();
    atualizarMetas();
  </script>
</body>
</html>
